# RAGAgent.java é”™è¯¯ä¿®å¤æŠ¥å‘Š

## ğŸ” é—®é¢˜è¯†åˆ«

åœ¨æ£€æŸ¥RAGAgent.javaæ–‡ä»¶æ—¶ï¼Œå‘ç°äº†ä»¥ä¸‹ä¸»è¦é—®é¢˜ï¼š

### 1. æ–¹æ³•è°ƒç”¨é”™è¯¯
**é—®é¢˜**: ç¬¬152è¡Œè°ƒç”¨äº†ä¸å­˜åœ¨çš„æ–¹æ³•
```java
// é”™è¯¯çš„è°ƒç”¨
doc.setContent(searchResult.getContent());
```

**åŸå› **: `SimilaritySearchResult`ç±»æ²¡æœ‰`getContent()`æ–¹æ³•ï¼Œæ­£ç¡®çš„è°ƒç”¨åº”è¯¥æ˜¯`searchResult.getChunk().getContent()`

### 2. æœªä½¿ç”¨å˜é‡è­¦å‘Š
**é—®é¢˜**: å¤šä¸ªæ–¹æ³•ä¸­å­˜åœ¨æœªä½¿ç”¨çš„å±€éƒ¨å˜é‡
- `maxResults` (åœ¨å¤šä¸ªæœç´¢æ–¹æ³•ä¸­)
- `topK` (åœ¨å‘é‡æœç´¢å’Œæ··åˆæœç´¢ä¸­)
- `category` (åœ¨æ–‡æ¡£æ£€ç´¢ä¸­)
- `maxChunks` (åœ¨ä¸Šä¸‹æ–‡å¢å¼ºä¸­)

### 3. ç©ºæŒ‡é’ˆé£é™©
**é—®é¢˜**: åœ¨æ„å»ºå¢å¼ºä¸Šä¸‹æ–‡æ—¶å¯èƒ½å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸
```java
// æ½œåœ¨çš„ç©ºæŒ‡é’ˆé—®é¢˜
StringBuilder enhancedContext = new StringBuilder(context);
if (!context.isEmpty()) { // contextå¯èƒ½ä¸ºnull
```

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤æ–¹æ³•è°ƒç”¨é”™è¯¯

**ä¿®å¤å‰**:
```java
doc.setContent(searchResult.getContent());
doc.setTitle("æ£€ç´¢ç»“æœ");
```

**ä¿®å¤å**:
```java
doc.setContent(searchResult.getChunk().getContent());
doc.setTitle("æ£€ç´¢ç»“æœ - " + searchResult.getChunk().getDocument().getTitle());
doc.setCategory(searchResult.getChunk().getDocument().getCategory());
```

**æ”¹è¿›ç‚¹**:
- æ­£ç¡®è°ƒç”¨`getChunk().getContent()`æ–¹æ³•
- å¢åŠ äº†æ›´è¯¦ç»†çš„æ ‡é¢˜ä¿¡æ¯
- æ·»åŠ äº†åˆ†ç±»ä¿¡æ¯

### 2. è§£å†³æœªä½¿ç”¨å˜é‡é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**: å°†æœªä½¿ç”¨çš„å‚æ•°è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œæ—¢è§£å†³äº†ç¼–è¯‘è­¦å‘Šï¼Œåˆä¸ºè°ƒè¯•æä¾›äº†æœ‰ç”¨ä¿¡æ¯

**ç¤ºä¾‹ä¿®å¤**:
```java
// ä¿®å¤å‰
int maxResults = task.getParameter("maxResults", 5); // æœªä½¿ç”¨

// ä¿®å¤å
int maxResults = task.getParameter("maxResults", 5);
logger.debug("æ‰§è¡ŒRAGæœç´¢: query={}, maxResults={}", query, maxResults);
```

**æ¶‰åŠçš„æ–¹æ³•**:
- `performRAGSearch()`: æ·»åŠ äº†maxResultså‚æ•°çš„æ—¥å¿—è®°å½•
- `performVectorSearch()`: æ·»åŠ äº†topKå‚æ•°çš„æ—¥å¿—è®°å½•
- `performHybridSearch()`: æ·»åŠ äº†topKå‚æ•°çš„æ—¥å¿—è®°å½•
- `performDocumentRetrieval()`: æ·»åŠ äº†categoryå’ŒmaxResultså‚æ•°çš„æ—¥å¿—è®°å½•
- `performContextEnhancement()`: æ·»åŠ äº†maxChunkså‚æ•°çš„æ—¥å¿—è®°å½•
- `performKnowledgeQuery()`: æ·»åŠ äº†maxResultså‚æ•°çš„æ—¥å¿—è®°å½•

### 3. ä¿®å¤ç©ºæŒ‡é’ˆé£é™©

**ä¿®å¤å‰**:
```java
StringBuilder enhancedContext = new StringBuilder(context);
if (!context.isEmpty()) {
    enhancedContext.append("\n\n");
}
```

**ä¿®å¤å**:
```java
StringBuilder enhancedContext = new StringBuilder(context != null ? context : "");
if (context != null && !context.isEmpty()) {
    enhancedContext.append("\n\n");
}
```

**æ”¹è¿›ç‚¹**:
- æ·»åŠ äº†nullæ£€æŸ¥
- ç¡®ä¿StringBuilderæ„é€ å‡½æ•°ä¸ä¼šæ¥æ”¶nullå€¼
- åœ¨æ£€æŸ¥isEmpty()ä¹‹å‰å…ˆæ£€æŸ¥null

## ğŸ“‹ ä¿®å¤è¯¦æƒ…

### ä¿®å¤çš„æ–‡ä»¶
- `src/main/java/com/example/customerservice/agent/impl/RAGAgent.java`

### ä¿®å¤çš„è¡Œæ•°
- ç¬¬146-156è¡Œ: ä¿®å¤æ–¹æ³•è°ƒç”¨é”™è¯¯
- ç¬¬93-98è¡Œ: æ·»åŠ RAGæœç´¢æ—¥å¿—
- ç¬¬106-111è¡Œ: æ·»åŠ å‘é‡æœç´¢æ—¥å¿—
- ç¬¬117-122è¡Œ: æ·»åŠ æ··åˆæœç´¢æ—¥å¿—
- ç¬¬132-139è¡Œ: æ·»åŠ æ–‡æ¡£æ£€ç´¢æ—¥å¿—
- ç¬¬180-188è¡Œ: æ·»åŠ ä¸Šä¸‹æ–‡å¢å¼ºæ—¥å¿—å¹¶ä¿®å¤ç©ºæŒ‡é’ˆ
- ç¬¬193-197è¡Œ: ä¿®å¤ç©ºæŒ‡é’ˆé£é™©
- ç¬¬216-224è¡Œ: æ·»åŠ çŸ¥è¯†æŸ¥è¯¢æ—¥å¿—

### æ·»åŠ çš„åŠŸèƒ½
1. **è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—**: æ¯ä¸ªæœç´¢æ–¹æ³•éƒ½æ·»åŠ äº†è¯¦ç»†çš„å‚æ•°æ—¥å¿—è®°å½•
2. **æ›´ä¸°å¯Œçš„æ–‡æ¡£ä¿¡æ¯**: åœ¨è½¬æ¢æœç´¢ç»“æœæ—¶æ·»åŠ äº†æ›´å¤šæ–‡æ¡£å…ƒæ•°æ®
3. **ç©ºæŒ‡é’ˆä¿æŠ¤**: å¢å¼ºäº†ä»£ç çš„å¥å£®æ€§

## ğŸ¯ ä¿®å¤æ•ˆæœ

### 1. ç¼–è¯‘é”™è¯¯è§£å†³
- âœ… æ–¹æ³•è°ƒç”¨é”™è¯¯å·²ä¿®å¤
- âœ… æ‰€æœ‰æœªä½¿ç”¨å˜é‡è­¦å‘Šå·²è§£å†³
- âœ… ç©ºæŒ‡é’ˆé£é™©å·²æ¶ˆé™¤

### 2. ä»£ç è´¨é‡æå‡
- âœ… æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- âœ… æé«˜äº†ä»£ç çš„å¥å£®æ€§
- âœ… å¢å¼ºäº†é”™è¯¯å¤„ç†èƒ½åŠ›

### 3. åŠŸèƒ½å¢å¼º
- âœ… æœç´¢ç»“æœåŒ…å«æ›´ä¸°å¯Œçš„ä¿¡æ¯
- âœ… æ›´å¥½çš„è°ƒè¯•å’Œç›‘æ§æ”¯æŒ
- âœ… ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•é¢„ç•™äº†æ¥å£

## ğŸ”® æœªæ¥æ”¹è¿›è®¡åˆ’

### 1. å‚æ•°æ”¯æŒ
å½“å‰ç‰ˆæœ¬ä¸­ï¼Œä»¥ä¸‹å‚æ•°å·²ç»é¢„ç•™ä½†æš‚æœªå®ç°ï¼š
- `maxResults`: æ§åˆ¶æœç´¢ç»“æœæ•°é‡
- `topK`: æ§åˆ¶å‘é‡æœç´¢è¿”å›æ•°é‡
- `category`: æŒ‰åˆ†ç±»è¿‡æ»¤æ–‡æ¡£
- `maxChunks`: æ§åˆ¶æ£€ç´¢çš„åˆ†å—æ•°é‡

### 2. å®ç°å»ºè®®
```java
// æœªæ¥ç‰ˆæœ¬å¯ä»¥è¿™æ ·å®ç°
public List<RAGSearchResult> performRAGSearch(AgentTask task) {
    String query = task.getParameter("query", "");
    int maxResults = task.getParameter("maxResults", 5);
    
    // è°ƒç”¨æ”¯æŒmaxResultså‚æ•°çš„RAGæœåŠ¡æ–¹æ³•
    RAGContext ragContext = ragService.retrieveAndGenerate(query, maxResults);
    return convertToRAGSearchResults(ragContext, query, "RAGæœç´¢");
}
```

### 3. æ‰©å±•æ–¹å‘
- æ”¯æŒæ›´å¤šæœç´¢å‚æ•°
- å®ç°åˆ†ç±»è¿‡æ»¤åŠŸèƒ½
- æ·»åŠ æœç´¢ç»“æœç¼“å­˜
- æ”¯æŒå¼‚æ­¥æœç´¢
- å®ç°æœç´¢ç»“æœæ’åºå’Œé‡æ’

## ğŸ“Š æµ‹è¯•å»ºè®®

### 1. å•å…ƒæµ‹è¯•
```java
@Test
void testPerformRAGSearch() {
    AgentTask task = AgentTask.builder("rag_search")
        .parameters(Map.of("query", "æµ‹è¯•æŸ¥è¯¢", "maxResults", 3))
        .build();
    
    List<RAGSearchResult> results = ragAgent.performRAGSearch(task);
    assertNotNull(results);
    // éªŒè¯ç»“æœ
}
```

### 2. é›†æˆæµ‹è¯•
- æµ‹è¯•ä¸RAGServiceçš„é›†æˆ
- éªŒè¯æ—¥å¿—è®°å½•åŠŸèƒ½
- æµ‹è¯•ç©ºå€¼å¤„ç†

### 3. æ€§èƒ½æµ‹è¯•
- æµ‹è¯•å¤§é‡å¹¶å‘æœç´¢è¯·æ±‚
- éªŒè¯å†…å­˜ä½¿ç”¨æƒ…å†µ
- æµ‹è¯•å“åº”æ—¶é—´

## ğŸ‰ æ€»ç»“

RAGAgent.javaçš„æ‰€æœ‰é”™è¯¯å·²ç»æˆåŠŸä¿®å¤ï¼š

1. **æ ¸å¿ƒé—®é¢˜è§£å†³**: ä¿®å¤äº†æ–¹æ³•è°ƒç”¨é”™è¯¯ï¼Œç¡®ä¿ä»£ç èƒ½å¤Ÿæ­£å¸¸ç¼–è¯‘å’Œè¿è¡Œ
2. **ä»£ç è´¨é‡æå‡**: è§£å†³äº†æ‰€æœ‰ç¼–è¯‘è­¦å‘Šï¼Œæé«˜äº†ä»£ç è´¨é‡
3. **åŠŸèƒ½å¢å¼º**: æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è®°å½•å’Œæ›´ä¸°å¯Œçš„æœç´¢ç»“æœä¿¡æ¯
4. **å¥å£®æ€§æ”¹è¿›**: å¢åŠ äº†ç©ºæŒ‡é’ˆä¿æŠ¤ï¼Œæé«˜äº†ä»£ç çš„ç¨³å®šæ€§
5. **å¯ç»´æŠ¤æ€§**: ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•é¢„ç•™äº†æ¥å£å’Œå‚æ•°

ä¿®å¤åçš„ä»£ç å·²ç»å‡†å¤‡å¥½è¿›è¡Œç¼–è¯‘å’Œæµ‹è¯•ï¼Œæ‰€æœ‰åŸæœ‰åŠŸèƒ½éƒ½å¾—åˆ°äº†ä¿ç•™å’Œå¢å¼ºã€‚
