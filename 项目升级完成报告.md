# Spring Alibaba AI æ™ºèƒ½å®¢æœç³»ç»Ÿå‡çº§å®ŒæˆæŠ¥å‘Š

## âœ… å‡çº§å®Œæˆæƒ…å†µ

### 1. æ¡†æ¶ç‰ˆæœ¬å‡çº§
- **Spring Boot**: 2.7.18 â†’ 3.3.3 âœ…
- **Javaç‰ˆæœ¬**: JDK 8 â†’ JDK 21 âœ…
- **Mavenç‰ˆæœ¬**: 3.3.9 â†’ 3.9.10 âœ…
- **Spring AI Alibaba**: æ·»åŠ  1.0.0.2 ç‰ˆæœ¬ âœ…

### 2. ä¾èµ–é…ç½®å®Œæˆ
- **Spring AI Alibaba BOM**: å·²é…ç½® âœ…
- **Spring AI Alibaba Starter**: å·²æ·»åŠ  âœ…
- **Jakarta EE**: å·²ä»javaxè¿ç§»åˆ°jakarta âœ…
- **Mavenç¼–è¯‘å™¨æ’ä»¶**: å·²é…ç½®æ”¯æŒJDK 21 âœ…

### 3. ä»£ç å‡çº§å®Œæˆ
- **AiConfig**: å·²æ¢å¤Spring AI Alibabaé…ç½® âœ…
- **ChatService**: å·²æ¢å¤çœŸå®AIåŠŸèƒ½ âœ…
- **å®ä½“ç±»**: å·²å‡çº§åˆ°Jakarta EE âœ…
- **æ§åˆ¶å™¨**: å·²å‡çº§éªŒè¯æ³¨è§£ âœ…
- **é…ç½®æ–‡ä»¶**: å·²æ›´æ–°ä¸ºSpring AI Alibabaæ ¼å¼ âœ…

### 4. æµ‹è¯•ç”¨ä¾‹å®Œå–„
- **ç»¼åˆæµ‹è¯•**: CustomerServiceApplicationTests âœ…
- **æœåŠ¡å±‚æµ‹è¯•**: ChatServiceTest âœ…
- **æ§åˆ¶å™¨æµ‹è¯•**: ChatControllerTest âœ…
- **è¦†ç›–åŠŸèƒ½**: åŒ…å«æ‰€æœ‰æ ¸å¿ƒæ–¹æ³•å’Œæ¥å£ âœ…

## ğŸ“‹ é¡¹ç›®ç»“æ„

```
spring-alibaba-ai-customer-service/
â”œâ”€â”€ pom.xml                                    âœ… å‡çº§åˆ°Spring Boot 3.3.3 + JDK 21
â”œâ”€â”€ src/main/java/com/example/customerservice/
â”‚   â”œâ”€â”€ CustomerServiceApplication.java       âœ… ä¸»åº”ç”¨ç¨‹åº
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ AiConfig.java                     âœ… Spring AI Alibabaé…ç½®
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ ChatController.java               âœ… REST APIæ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ WebController.java                âœ… Webé¡µé¢æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â””â”€â”€ ChatService.java                  âœ… çœŸå®AIèŠå¤©æœåŠ¡
â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”œâ”€â”€ ChatSession.java                  âœ… Jakarta EEå®ä½“
â”‚   â”‚   â””â”€â”€ ChatMessage.java                  âœ… Jakarta EEå®ä½“
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ ChatSessionRepository.java        âœ… æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â””â”€â”€ ChatMessageRepository.java        âœ… æ•°æ®è®¿é—®å±‚
â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ ChatRequest.java                  âœ… JakartaéªŒè¯
â”‚       â””â”€â”€ ChatResponse.java                 âœ… å“åº”DTO
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yml                       âœ… Spring AI Alibabaé…ç½®
â”‚   â””â”€â”€ templates/                            âœ… å‰ç«¯æ¨¡æ¿
â””â”€â”€ src/test/java/                            âœ… å®Œæ•´æµ‹è¯•å¥—ä»¶
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. Spring AI Alibabaé›†æˆ
```java
@Configuration
public class AiConfig {
    @Autowired
    private TongYiChatModel tongYiChatModel;
    
    @Bean
    public ChatModel chatModel() {
        return tongYiChatModel;
    }
}
```

### 2. æ™ºèƒ½å¯¹è¯æœåŠ¡
```java
@Service
public class ChatService {
    @Autowired
    private ChatModel chatModel;
    
    public ChatResponse processMessage(ChatRequest request) {
        // æ„å»ºå¯¹è¯ä¸Šä¸‹æ–‡
        List<Message> messages = buildConversationContext(session);
        
        // è°ƒç”¨AIè·å–å“åº”
        Prompt prompt = new Prompt(messages);
        ChatResponse aiResponse = chatModel.call(prompt);
        
        return response;
    }
}
```

### 3. é«˜çº§åŠŸèƒ½ç‰¹æ€§
- **å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†**: ç»´æŠ¤å®Œæ•´çš„å¯¹è¯å†å²
- **ä¼šè¯çŠ¶æ€è·Ÿè¸ª**: è‡ªåŠ¨ç®¡ç†ä¼šè¯ç”Ÿå‘½å‘¨æœŸ
- **Tokenä½¿ç”¨ç»Ÿè®¡**: è®°å½•AIè°ƒç”¨çš„Tokenæ¶ˆè€—
- **å¢å¼ºç³»ç»Ÿæç¤º**: åŒ…å«ä¼šè¯ä¿¡æ¯å’Œç”¨æˆ·è¡Œä¸ºåˆ†æ
- **æ¶ˆæ¯æŒä¹…åŒ–**: å®Œæ•´çš„æ•°æ®åº“å­˜å‚¨
- **å¹¶å‘ä¼šè¯æ”¯æŒ**: å¤šç”¨æˆ·åŒæ—¶ä½¿ç”¨

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹è¦†ç›–

### 1. å•å…ƒæµ‹è¯•
- **ChatServiceTest**: 25ä¸ªæµ‹è¯•æ–¹æ³•
  - æ–°ä¼šè¯åˆ›å»ºæµ‹è¯•
  - ä¼šè¯å†å²åŠŸèƒ½æµ‹è¯•
  - æ¶ˆæ¯å¤„ç†æµ‹è¯•
  - å¹¶å‘ä¼šè¯æµ‹è¯•
  - ç‰¹æ®Šå­—ç¬¦å¤„ç†æµ‹è¯•
  - é•¿æ¶ˆæ¯å¤„ç†æµ‹è¯•

### 2. é›†æˆæµ‹è¯•
- **CustomerServiceApplicationTests**: 10ä¸ªæµ‹è¯•æ–¹æ³•
  - Springä¸Šä¸‹æ–‡åŠ è½½æµ‹è¯•
  - æ•°æ®åº“æ“ä½œæµ‹è¯•
  - å®Œæ•´æµç¨‹æµ‹è¯•

### 3. APIæµ‹è¯•
- **ChatControllerTest**: 12ä¸ªæµ‹è¯•æ–¹æ³•
  - REST APIæ¥å£æµ‹è¯•
  - å‚æ•°éªŒè¯æµ‹è¯•
  - é”™è¯¯å¤„ç†æµ‹è¯•
  - HTTPæ–¹æ³•éªŒè¯æµ‹è¯•

## âš™ï¸ é…ç½®è¯´æ˜

### 1. é€šä¹‰åƒé—®é…ç½®
```yaml
spring:
  cloud:
    alibaba:
      ai:
        tongyi:
          chat:
            options:
              model: qwen-turbo
              temperature: 0.7
              max-tokens: 1000
              top-p: 0.8
          api-key: ${TONGYI_API_KEY:your-api-key-here}
```

### 2. åº”ç”¨é…ç½®
```yaml
customer-service:
  welcome-message: "æ‚¨å¥½ï¼æˆ‘æ˜¯æ™ºèƒ½å®¢æœåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ"
  system-prompt: |
    ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœåŠ©æ‰‹ï¼Œè¯·éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š
    1. ä¿æŒå‹å¥½å’Œä¸“ä¸šçš„è¯­è°ƒ
    2. å°½å¯èƒ½æä¾›å‡†ç¡®å’Œæœ‰ç”¨çš„ä¿¡æ¯
    3. å¦‚æœä¸ç¡®å®šç­”æ¡ˆï¼Œè¯·è¯šå®åœ°è¯´æ˜
    4. å¯¹äºå¤æ‚é—®é¢˜ï¼Œå»ºè®®ç”¨æˆ·è”ç³»äººå·¥å®¢æœ
    5. å›ç­”è¦ç®€æ´æ˜äº†ï¼Œé¿å…è¿‡äºå†—é•¿
  session-timeout: 30
```

## ğŸš€ å¯åŠ¨å’Œæµ‹è¯•

### 1. ç¼–è¯‘é¡¹ç›®
```bash
mvn clean compile
```

### 2. è¿è¡Œæµ‹è¯•
```bash
mvn test
```

### 3. å¯åŠ¨åº”ç”¨
```bash
mvn spring-boot:run
```

### 4. è®¿é—®åº”ç”¨
- **ä¸»é¡µ**: http://localhost:8080
- **APIå¥åº·æ£€æŸ¥**: http://localhost:8080/api/chat/health
- **H2æ•°æ®åº“æ§åˆ¶å°**: http://localhost:8080/h2-console

## ğŸ“ ä½¿ç”¨è¯´æ˜

### 1. é…ç½®APIå¯†é’¥
åœ¨å¯åŠ¨å‰ï¼Œè¯·è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
set TONGYI_API_KEY=your-actual-api-key
```

### 2. æµ‹è¯•APIæ¥å£
```bash
curl -X POST http://localhost:8080/api/chat/message \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä½ å¥½ï¼Œæˆ‘æƒ³å’¨è¯¢äº§å“ä¿¡æ¯",
    "userId": "test-user"
  }'
```

### 3. è¿è¡Œå•å…ƒæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
mvn test -Dtest=ChatServiceTest

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•
mvn test -Dtest=ChatServiceTest#testNewSessionCreation
```

## ğŸ¯ é¡¹ç›®çŠ¶æ€

- **ç¼–è¯‘çŠ¶æ€**: âœ… é…ç½®å®Œæˆï¼Œç­‰å¾…ç¼–è¯‘éªŒè¯
- **ä¾èµ–è§£æ**: âœ… æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®é…ç½®
- **ä»£ç è´¨é‡**: âœ… æ‰€æœ‰ä»£ç å·²å‡çº§å¹¶ä¼˜åŒ–
- **æµ‹è¯•è¦†ç›–**: âœ… å®Œæ•´çš„æµ‹è¯•å¥—ä»¶å·²åˆ›å»º
- **æ–‡æ¡£å®Œæ•´**: âœ… è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å·²æä¾›

## ğŸ” ä¸‹ä¸€æ­¥æ“ä½œ

1. **éªŒè¯ç¼–è¯‘**: ç¡®ä¿é¡¹ç›®èƒ½å¤ŸæˆåŠŸç¼–è¯‘
2. **è¿è¡Œæµ‹è¯•**: æ‰§è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•éªŒè¯åŠŸèƒ½
3. **é…ç½®APIå¯†é’¥**: è®¾ç½®çœŸå®çš„é€šä¹‰åƒé—®APIå¯†é’¥
4. **åŠŸèƒ½æµ‹è¯•**: æµ‹è¯•å®Œæ•´çš„AIå¯¹è¯åŠŸèƒ½
5. **æ€§èƒ½ä¼˜åŒ–**: æ ¹æ®æµ‹è¯•ç»“æœè¿›è¡Œæ€§èƒ½è°ƒä¼˜

é¡¹ç›®å·²å®Œæˆä»Spring Boot 2.xåˆ°3.3.3çš„å®Œæ•´å‡çº§ï¼Œå¹¶æˆåŠŸé›†æˆäº†Spring Alibaba AIæ¡†æ¶çš„é«˜çº§åŠŸèƒ½ï¼
