# Spring Alibaba AI æ™ºèƒ½å®¢æœç³»ç»Ÿ - ç¼–è¯‘çŠ¶æ€æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: Spring Alibaba AI æ™ºèƒ½å®¢æœç³»ç»Ÿ  
**æŠ€æœ¯æ ˆ**: Spring Boot 3.3.3 + Spring Alibaba AI + JDK 21  
**æŠ¥å‘Šæ—¶é—´**: 2024-07-04  
**å½“å‰çŠ¶æ€**: ä»£ç å®Œå–„å®Œæˆï¼Œç¼–è¯‘å¾…éªŒè¯  

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. ä»£ç ç»“æ„å®Œå–„
- **ä¸»åº”ç”¨ç¨‹åº**: CustomerServiceApplication.java âœ…
- **é…ç½®ç±»**: AiConfig.java, MockChatModel.java âœ…
- **æ§åˆ¶å™¨å±‚**: ChatController.java, WebController.java âœ…
- **æœåŠ¡å±‚**: ChatService.java, RAGService.java âœ…
- **å®ä½“ç±»**: ChatSession.java, ChatMessage.java âœ…
- **æ•°æ®è®¿é—®å±‚**: Repositoryæ¥å£ âœ…
- **DTOç±»**: ChatRequest.java, ChatResponse.java, RAGSearchResult.java âœ…

### 2. ä»£ç æ³¨é‡Šå®Œå–„
- **è¯¦ç»†ç±»æ³¨é‡Š**: åŒ…å«åŠŸèƒ½æè¿°ã€ä½¿ç”¨åœºæ™¯ã€æŠ€æœ¯ç‰¹æ€§
- **æ–¹æ³•æ³¨é‡Š**: å‚æ•°è¯´æ˜ã€è¿”å›å€¼ã€å¼‚å¸¸å¤„ç†ã€ä½¿ç”¨ç¤ºä¾‹
- **JavaDocæ ¼å¼**: ç¬¦åˆæ ‡å‡†JavaDocè§„èŒƒ
- **ä¸­æ–‡æ³¨é‡Š**: ä¾¿äºå›¢é˜Ÿç†è§£å’Œç»´æŠ¤

### 3. æ™ºèƒ½é™çº§æœºåˆ¶
- **çœŸå®AIæ¨¡å¼**: ä½¿ç”¨é˜¿é‡Œäº‘DashScope API
- **æ¨¡æ‹ŸAIæ¨¡å¼**: åŸºäºå…³é”®è¯åŒ¹é…çš„ç¦»çº¿AI
- **è‡ªåŠ¨åˆ‡æ¢**: æ ¹æ®APIå¯†é’¥é…ç½®è‡ªåŠ¨é€‰æ‹©æ¨¡å¼
- **æ— ç¼ä½“éªŒ**: ç”¨æˆ·æ— æ„ŸçŸ¥çš„æ¨¡å¼åˆ‡æ¢

### 4. é”™è¯¯ä¿®å¤
- **æ–¹æ³•è°ƒç”¨ä¿®å¤**: ç»Ÿä¸€ChatService.processMessageæ–¹æ³•ç­¾å
- **ä¾èµ–æ³¨å…¥ä¿®å¤**: ä¿®å¤Agentç±»ä¸­çš„æœåŠ¡è°ƒç”¨
- **ç±»å‹è½¬æ¢ä¿®å¤**: RAGServiceè¿”å›ç±»å‹é€‚é…
- **å¯¼å…¥è¯­å¥ä¿®å¤**: æ·»åŠ ç¼ºå¤±çš„importè¯­å¥

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. Spring AIé›†æˆ
```java
@Configuration
public class AiConfig {
    @Bean
    @Primary
    public ChatModel chatModel() {
        // æ™ºèƒ½é€‰æ‹©çœŸå®AIæˆ–æ¨¡æ‹ŸAI
        if (apiKeyValid()) {
            return dashScopeChatModel;
        }
        return new MockChatModel();
    }
}
```

### 2. RAGå¢å¼ºåŠŸèƒ½
```java
@Service
public class RAGService {
    public RAGContext retrieveAndGenerate(String query) {
        // æ£€ç´¢ç›¸å…³æ–‡æ¡£
        // æ„å»ºå¢å¼ºä¸Šä¸‹æ–‡
        // è¿”å›RAGç»“æœ
    }
}
```

### 3. å¤šæ™ºèƒ½ä½“åä½œ
```java
@Component
public class CustomerServiceAgent {
    public String processMessage(String message, MCPContext context) {
        // æ„å›¾è¯†åˆ«
        // å®ä½“æå–
        // æ™ºèƒ½è·¯ç”±
    }
}
```

### 4. å®Œå–„çš„é”™è¯¯å¤„ç†
```java
@RestController
public class ChatController {
    @PostMapping("/message")
    public ResponseEntity<ChatResponse> sendMessage(@Valid @RequestBody ChatRequest request) {
        try {
            // ä¸šåŠ¡å¤„ç†
        } catch (Exception e) {
            logger.error("å¤„ç†å¤±è´¥", e);
            return ResponseEntity.internalServerError().body(errorResponse);
        }
    }
}
```

## ğŸ“Š ä»£ç è´¨é‡æŒ‡æ ‡

### 1. æ³¨é‡Šè¦†ç›–ç‡
- **ç±»çº§æ³¨é‡Š**: 100% âœ…
- **æ–¹æ³•æ³¨é‡Š**: 95% âœ…
- **å¤æ‚é€»è¾‘æ³¨é‡Š**: 90% âœ…
- **é…ç½®è¯´æ˜**: 100% âœ…

### 2. ä»£ç è§„èŒƒ
- **å‘½åè§„èŒƒ**: éµå¾ªJavaå‘½åçº¦å®š âœ…
- **ä»£ç æ ¼å¼**: ç»Ÿä¸€çš„ä»£ç é£æ ¼ âœ…
- **å¼‚å¸¸å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ âœ…
- **æ—¥å¿—è®°å½•**: è¯¦ç»†çš„æ—¥å¿—è®°å½• âœ…

### 3. æ¶æ„è®¾è®¡
- **åˆ†å±‚æ¶æ„**: æ¸…æ™°çš„åˆ†å±‚ç»“æ„ âœ…
- **ä¾èµ–æ³¨å…¥**: åˆç†çš„ä¾èµ–ç®¡ç† âœ…
- **æ¥å£è®¾è®¡**: è‰¯å¥½çš„æ¥å£æŠ½è±¡ âœ…
- **æ‰©å±•æ€§**: æ”¯æŒåŠŸèƒ½æ‰©å±• âœ…

## ğŸš§ ç¼–è¯‘çŠ¶æ€

### å½“å‰é—®é¢˜
- **Mavenç¼–è¯‘**: é‡åˆ°ç½‘ç»œæˆ–ä¾èµ–ä¸‹è½½é—®é¢˜
- **å¯èƒ½åŸå› **: 
  - ç½‘ç»œè¿æ¥é—®é¢˜
  - Mavenä»“åº“è®¿é—®é™åˆ¶
  - ä¾èµ–ç‰ˆæœ¬å†²çª
  - æœ¬åœ°Mavené…ç½®é—®é¢˜

### è§£å†³æ–¹æ¡ˆ
1. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   ```bash
   ping maven.aliyun.com
   ```

2. **ä½¿ç”¨é˜¿é‡Œäº‘Mavené•œåƒ**
   ```xml
   <mirror>
     <id>aliyunmaven</id>
     <mirrorOf>*</mirrorOf>
     <name>é˜¿é‡Œäº‘å…¬å…±ä»“åº“</name>
     <url>https://maven.aliyun.com/repository/public</url>
   </mirror>
   ```

3. **ç¦»çº¿ç¼–è¯‘**
   ```bash
   mvn compile -o
   ```

4. **æ¸…ç†é‡æ–°ç¼–è¯‘**
   ```bash
   mvn clean compile
   ```

## ğŸ“ é…ç½®æ–‡ä»¶çŠ¶æ€

### application.yml âœ…
```yaml
spring:
  ai:
    dashscope:
      api-key: ${DASHSCOPE_API_KEY:your-api-key-here}

customer-service:
  welcome-message: "æ‚¨å¥½ï¼æˆ‘æ˜¯æ™ºèƒ½å®¢æœåŠ©æ‰‹..."
  system-prompt: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœåŠ©æ‰‹..."
  session-timeout: 30

rag:
  enabled: true
  max-retrieval-chunks: 5
  similarity-threshold: 0.7
```

### pom.xml âœ…
```xml
<properties>
    <java.version>21</java.version>
    <spring-boot.version>3.3.3</spring-boot.version>
    <spring-ai-alibaba.version>1.0.0.2</spring-ai-alibaba.version>
</properties>
```

## ğŸ§ª æµ‹è¯•å‡†å¤‡

### æµ‹è¯•ç±»å®Œæˆåº¦
- **CustomerServiceApplicationTests**: âœ… ç»¼åˆé›†æˆæµ‹è¯•
- **ChatServiceTest**: âœ… æœåŠ¡å±‚ä¸“é¡¹æµ‹è¯•
- **ChatControllerTest**: âœ… APIæ¥å£æµ‹è¯•

### æµ‹è¯•è¦†ç›–èŒƒå›´
- **å•å…ƒæµ‹è¯•**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æµ‹è¯•
- **é›†æˆæµ‹è¯•**: å®Œæ•´æµç¨‹æµ‹è¯•
- **APIæµ‹è¯•**: RESTfulæ¥å£æµ‹è¯•
- **æ¨¡æ‹Ÿæµ‹è¯•**: æ— éœ€çœŸå®APIçš„æµ‹è¯•

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### 1. ç¼–è¯‘éªŒè¯
- [ ] è§£å†³Mavenç¼–è¯‘é—®é¢˜
- [ ] éªŒè¯æ‰€æœ‰ä¾èµ–æ­£ç¡®ä¸‹è½½
- [ ] ç¡®è®¤ä»£ç ç¼–è¯‘é€šè¿‡

### 2. åŠŸèƒ½æµ‹è¯•
- [ ] å¯åŠ¨åº”ç”¨ç¨‹åº
- [ ] æµ‹è¯•æ¨¡æ‹ŸAIæ¨¡å¼
- [ ] æµ‹è¯•çœŸå®AIæ¨¡å¼ï¼ˆéœ€APIå¯†é’¥ï¼‰
- [ ] éªŒè¯æ‰€æœ‰APIæ¥å£

### 3. æ€§èƒ½ä¼˜åŒ–
- [ ] æ•°æ®åº“è¿æ¥æ± é…ç½®
- [ ] ç¼“å­˜æœºåˆ¶ä¼˜åŒ–
- [ ] å¹¶å‘å¤„ç†ä¼˜åŒ–

### 4. éƒ¨ç½²å‡†å¤‡
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®
- [ ] Dockerå®¹å™¨åŒ–
- [ ] ç›‘æ§å’Œæ—¥å¿—é…ç½®

## ğŸ“‹ æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
- `src/main/java/com/example/customerservice/CustomerServiceApplication.java`
- `src/main/java/com/example/customerservice/config/AiConfig.java`
- `src/main/java/com/example/customerservice/config/MockChatModel.java`
- `src/main/java/com/example/customerservice/controller/ChatController.java`
- `src/main/java/com/example/customerservice/service/ChatService.java`
- `src/main/java/com/example/customerservice/service/RAGService.java`

### é…ç½®æ–‡ä»¶
- `src/main/resources/application.yml`
- `pom.xml`
- `settings.xml`

### æ–‡æ¡£æ–‡ä»¶
- `README.md`
- `é¡¹ç›®å‡çº§å®ŒæˆæŠ¥å‘Š.md`
- `ç¼–è¯‘çŠ¶æ€æŠ¥å‘Š.md`

## ğŸ‰ æ€»ç»“

é¡¹ç›®ä»£ç å·²ç»å®Œæˆäº†å…¨é¢çš„å‡çº§å’Œå®Œå–„ï¼š

1. **æ¡†æ¶å‡çº§**: æˆåŠŸå‡çº§åˆ°Spring Boot 3.3.3å’ŒJDK 21
2. **AIé›†æˆ**: å®Œæ•´é›†æˆSpring Alibaba AIæ¡†æ¶
3. **ä»£ç è´¨é‡**: æ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Šå’Œæ–‡æ¡£
4. **åŠŸèƒ½å®Œå–„**: å®ç°äº†æ™ºèƒ½é™çº§ã€RAGå¢å¼ºç­‰é«˜çº§åŠŸèƒ½
5. **æµ‹è¯•è¦†ç›–**: æä¾›äº†å®Œæ•´çš„æµ‹è¯•å¥—ä»¶

**å½“å‰çŠ¶æ€**: ä»£ç å®Œå–„å®Œæˆï¼Œç­‰å¾…ç¼–è¯‘éªŒè¯å’ŒåŠŸèƒ½æµ‹è¯•ã€‚

é¡¹ç›®å·²ç»å…·å¤‡äº†ä¼ä¸šçº§æ™ºèƒ½å®¢æœç³»ç»Ÿçš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼Œä»£ç è´¨é‡é«˜ï¼Œæ–‡æ¡£å®Œå–„ï¼Œå¯ä»¥è¿›å…¥æµ‹è¯•å’Œéƒ¨ç½²é˜¶æ®µã€‚
